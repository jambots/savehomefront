<!DOCTYPE HTML>
<html>
<head>
<title>S.A.V.E HOME FRONT</title>
<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" type="text/css" href="reset-min.css">
<style type="text/css">
body, html{width:100%; height:100%; overflow:hidden; scrollbars:none; font-family:batmanforeveralternateregular;}
#wrapper{width:100%; height:100%;}
#greendiv{width:100%; height:100%;background-image:url("images/greenburst.jpg"); background-size:cover; background-position:50% 50%;}
#dl{position:absolute; width:80px; height:60px; bottom:4px; left:4px;}
#player{position:absolute; width:60px; height:60px; bottom:4px; right:4px;}
#greentext{text-align:center; position:absolute;}
body{background-image:url("images/bgimagelarge.jpg"); background-size:cover; background-position:50% 50%;}
.button{position:absolute; background-size:contain; background-position:50% 50%; background-repeat:no-repeat;}
@font-face {
    font-family: 'batmanforeveralternateregular';
    src: url('batmfa__-webfont.woff2') format('woff2'),
         url('batmfa__-webfont.woff') format('woff');
    font-weight: normal;
    font-style: normal;

}
</style>
<script src="steel.js?4"></script>
<script src="cordova.js"></script>
<script>
var greenUp=false;
var ww=1;
var wh=1;
function geometryTick(){
  if((ww != window.innerWidth)||(wh != window.innerHeight)){
    ww = window.innerWidth;
    wh = window.innerHeight;
    geometry();
  }
}
function geometry(){
  if(ww/wh<1){portraitGeometry();}
  else{landscapeGeometry();}// is in steel.js
}
/*
  document.getElementById('greendiv').style.display="none";
  document.getElementById('wrapper').style.display="block";
*/
function portraitGeometry(){
  var windowAspect=ww/wh;
  var grid=1;
  var contentAspect=10/15;
  var topPad=0;
  var leftPad=0;
  if(contentAspect>windowAspect){//wide, pad top
    grid=ww/10;
    topPad=(wh-grid*15)/2;
  } else {// tall pad side
    grid=wh/15;
    leftPad=(ww-grid*10)/2;
  }
  console.log(grid);

  var style = document.createElement('style');
  style.type = 'text/css';
  style.innerHTML='';
  style.innerHTML +='body{font-size:'+grid/2.5+'px;}';
  if(greenUp){
    console.log('greenUp');
    style.innerHTML +='#greenDiv{display:block;}';
    style.innerHTML +='#greentext{display:block;}';
    style.innerHTML +='#greenback{display:block;}';
    style.innerHTML +='#wrapper{display:none;}';
  } else {
    console.log('NOT greenUp');
    style.innerHTML +='#greenDiv{display:none;}';
    style.innerHTML +='#greentext{display:none;}';
    style.innerHTML +='#greenback{display:none;}';
    style.innerHTML +='#wrapper{display:block;}';
  }
  style.innerHTML +='#steelCanvas{display:none;}';
  style.innerHTML +='#steelControls{display:none;}';
  style.innerHTML +='#loadingDiv{background-image:url(imageslarge/loading.png); background-size:contain;}';
  style.innerHTML +='#loadingDiv{display:block; height:'+grid*4+'px; width:'+grid*4+'px;}';
  style.innerHTML +='#loadingDiv{top:'+(wh-grid*4)/2+'px; left:'+(ww-grid*4)/2+'px; position:absolute;}';
  
  for (var b=0; b<buttons.length; b++){  
    console.log(buttons[b]);
    var button=buttons[b];
    var top;
    if(button.top=="m"){
      top=(wh-button.height*grid)/2;
      console.log(top);
    }
    else{
      top =(button.top*grid);
      if(button.top<0){
        top=(wh+button.top*grid);
      }
    }
    style.innerHTML +='#'+button.id+'{left:'+(leftPad+button.left*grid)+'px; top:'+top+'px;}';
    style.innerHTML +='#'+button.id+'{width:'+(button.width*grid)+'px; height:'+(button.height*grid)+'px;}';
  }
  document.getElementsByTagName('head')[0].appendChild(style);
  console.log('greentext '+document.getElementById('greentext').style.display);
}

function landscapeGeometry(){
  console.log('landscapeGeometry');
  
  var windowAspect=ww/wh;
  grid=1;
  var contentAspect=16/9;
  topPad=0;
  leftPad=0;
  if(contentAspect>windowAspect){//wide, pad top
    grid=ww/16;
    topPad=(wh-grid*9)/2;
  } else {// tall pad side
    grid=wh/9;
    leftPad=(ww-grid*16)/2;
  }
  cellSize=grid*14/12;
  //console.log(grid);

  var style = document.createElement('style');
  style.type = 'text/css';
  style.innerHTML='';
  style.innerHTML +='body{font-size:'+grid/2.5+'px;}';
  style.innerHTML +='#wrapper{display:none;}';
  style.innerHTML +='#greenDiv{display:none;}';
  style.innerHTML +='#greentext{display:none;}';
  style.innerHTML +='#greenback{display:none;}';
  style.innerHTML +='#steelCanvas{display:block; position:absolute;}';
  style.innerHTML +='#steelControls{display:block; position:absolute;}';
  style.innerHTML +='#loadingDiv{background-image:url(imageslarge/loading.png); background-size:contain;}';
  style.innerHTML +='#loadingDiv{display:block; height:'+grid*4+'px; width:'+grid*4+'px;}';
  style.innerHTML +='#loadingDiv{top:'+(wh-grid*4)/2+'px; left:'+(ww-grid*4)/2+'px; position:absolute;}';
  document.getElementsByTagName('head')[0].appendChild(style);

  var steelCanv=document.getElementById('steelCanvas');
  steelCanv.width=ww;
  steelCanv.height=wh;
  controls.style.width=ww+"px";
  controls.style.height=wh+"px";

  var steelCtx=steelCanv.getContext('2d');
  if(helmsImage !==null){
    steelCtx.drawImage(helmsImage,leftPad,topPad,grid*14,grid*4.5);
  }
  if(triadImage !==null){
    steelCtx.drawImage(triadImage,leftPad,topPad+grid*4.5,grid*14,grid*4.5);
  }
  drawKeys();
}



var canv;
function openUrl(url){
cordova.InAppBrowser.open(url, "_system")
}
function flashlightOn(){
  window.plugins.flashlight.available(function(isAvailable) {
    if (isAvailable) {
      window.plugins.flashlight.toggle(
        function() {}, // optional success callback
        function() {}, // optional error callback
        {intensity: 1} // optional as well, used on iOS when switching on
      ); 
    } else {
      alert("Flashlight not available on this device");
    }
  });
}

function handleEvent(e){
  //console.log(e.target.id);
  e.stopPropagation();
  e.preventDefault();
  for (var b=0; b<buttons.length; b++){
    if(e.target.id==buttons[b].id){
      buttons[b].func();
    }
  }
}



          function playSound(el,soundfile) {
              if (el.mp3) {
                  if(el.mp3.paused) el.mp3.play();
                  else el.mp3.pause();
              } else {
                  el.mp3 = new Audio(soundfile);
                  el.mp3.play();
              }
          }




function setupButtons(){
  console.log('setupButtons');
  var style = document.createElement('style');
  style.type = 'text/css';
  style.innerHTML ='';
  for (var b=0; b<buttons.length; b++){  
    var button=buttons[b];
    //style.innerHTML +='#'+button.id+'{background-color:rgba('+rnd(255)+',0,255,.5);}';
    style.innerHTML +='#'+button.id+'{background-image:url("images/'+button.id+'.png");}';
    document.getElementsByTagName('head')[0].appendChild(style);
    var el=document.getElementById(button.id);
    el.addEventListener("click", function(evt){
      handleEvent(evt)
    });
    el.addEventListener("touchstart", function(evt){
      handleEvent(evt)
      
    });
    
  }

}

function rnd(range){
  return Math.floor(Math.random()*range);
}
var logoUp=true;


function clickPlay(e){
  playSound(this, 'teaser.mp3');
  if (!e){
    var e = window.event; 
    e.cancelBubble = true;}  
  if (e.stopPropagation){e.stopPropagation();}
}

var buttons=[
{id:"shflogo", top:.5, left:3, width:4, height:2, func:function(){openUrl('http://www.savehomefront.org');}},
{id:"helpup", top:2.5, left:.5, width:9, height:1, func:function(){openUrl('https://youtu.be/ajtE1ymZdTA');}},
{id:"greenlight", top:-5.5, left:1, width:1.5, height:2.5, func:function(){openGreen();}},
{id:"bell", top:-5.5, left:2.5, width:2.5, height:2.5, func:function(){getRingtone();}},
{id:"donate", top:-5.5, left:5, width:2.5, height:2.5, func:function(){openUrl('https://portal.icheckgateway.com/SaveXXII/');}},
{id:"flashlight", top:-5.5, left:7.5, width:1.5, height:2.5, func:function(){flashlightOn();}},
{id:"facebook", top:-2.5, left:1, width:2, height:2, func:function(){openUrl('https://www.facebook.com/savehomefront.org/');}},
{id:"twitter", top:-2.5, left:3, width:2, height:2, func:function(){openUrl('https://twitter.com/savehomefront');}},
{id:"instagram", top:-2.5, left:5, width:2, height:2, func:function(){openUrl('https://www.instagram.com/savehomefront/');}},
{id:"youtube", top:-2.5, left:7, width:2, height:2, func:function(){openUrl('https://www.youtube.com/channel/UC52CErEEsLZf23J3QRr04tw');}},
{id:"greentext", top:"m", left:.5, width:9, height:11, func:function(){closeGreen();}},
{id:"greenback", top:-2.5, left:.5, width:2, height:2, func:function(){closeGreen();}},
];
function getRingtone(){
  if(device.platform=="iOS"){
    openUrl('https://jambots.com/save/audio/Leave_a_Light_On-Ringtone.m4r');
  } else{
    openUrl('https://jambots.com/save/audio/Leave_a_Light_On-Ringtone.mp3');
  }  
}
function closeGreen(){
  greenUp=false;
  geometry();
}
function openGreen(){
  greenUp=true;
  geometry();
}

function init(){
  console.log('init()');
  document.addEventListener("deviceready", resumeInit, false);
}
var controls;
function resumeInit(){
  console.log('resumeInit()');
  canv=document.getElementById('steelCanvas');
  controls=document.getElementById('steelControls');
  controls.addEventListener('touchstart', touchStart, false);
  controls.addEventListener('touchmove', touchMove, false);
  controls.addEventListener('touchend', touchEnd, false);

/*


  controls.addEventListener('mousedown', mouseDown, false);
  controls.addEventListener('mousemove', mouseMove, false);
  controls.addEventListener('mouseup', mouseUp, false);
*/
  setupButtons();
  window.setInterval("geometryTick()",1000);
  geometryTick();
  initAudio();
  helmsImage = new Image();
  helmsImage.addEventListener("load", imageLoaded, false);
  helmsImage.src = "imageslarge/bg_helms.png";
  triadImage = new Image();
  triadImage.addEventListener("load", imageLoaded, false);
  triadImage.src = "imageslarge/bg_triad.png"
}
function touchStart(evt){
  evt.preventDefault ();

      var syn={type:"touchstart", touches:[]};
      for (var t=0; t<evt.touches.length; t++){
        syn.touches.push({identifier:evt.touches[t].identifier, pageX:evt.touches[t].pageX, pageY:evt.touches[t].pageY});
      }

  handleSteelEvent(syn);
}
function touchMove(evt){
 // alert('touchMove');
  evt.preventDefault ();
      var syn={type:"touchmove", touches:[]};
      for (var t=0; t<evt.touches.length; t++){
        syn.touches.push({identifier:evt.touches[t].identifier, pageX:evt.touches[t].pageX, pageY:evt.touches[t].pageY});
      }

  handleSteelEvent(syn);
}
function touchEnd(evt){
  evt.preventDefault();
      var syn={type:"touchend", touches:[]};

  handleSteelEvent(syn);
}

var mouseDragging=false;
function mouseDown(event){
  event.preventDefault();
  //console.log(event);
  handleSteelEvent({type:"touchstart", touches:[{identifier:99, pageX:event.clientX, pageY:event.clientY}]});
  mouseDragging=true;
}
function mouseMove(event){
  event.preventDefault();
  if(mouseDragging){
    //console.log(event);
    handleSteelEvent({type:"touchmove", touches:[{identifier:99, pageX:event.clientX, pageY:event.clientY}]});
  }
}
function mouseUp(event){
  event.preventDefault();
  //console.log(event);
  handleSteelEvent({type:"touchend",touches:[]});
  mouseDragging=false;
}

function imageLoaded(){
  //console.log('imageLoaded')
  geometry();
}
var helmsImage=null;
var triadImage=null;
</script>

<body onload="init()">

<!--
  <script>
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.11';
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
  </script>
-->
  <div id="wrapper" >
    <div id="icon" class="button"></div>
    <div id="shflogo" class="button"></div>
    <div id="greenlight" class="button"></div><div id="bell" class="button"></div>
    <div id="flashlight" class="button"></div><div id="donate" class="button"></div>
    <div id="facebook" class="button"></div><div id="twitter" class="button"></div>
    <div id="instagram" class="button"></div><div id="youtube" class="button"></div>
    <div id="helpup" class="button"></div>
  </div>
  <div id="greendiv">
    <div id="greentext" class="button">
      <b>What The Green Light Means</b><br /><br />
      You’re letting Veterans know you support them as they leave military service and become your
      community neighbor.<br /><br />
      Let this light shine from your home, workplace or phone.<br /><br />
      Green is a powerful color, meaning growth, possibility, beginnings.<br /><br />
      As this light shines, it shows that through us, the mission continues.<br /><br />
      <b>Leave A Light On</b><br />to show your support!
    </div>
    <div id="greenback" class="button"></div>
  </div>

  <canvas id="steelCanvas"></canvas>
  <div id="steelControls"></div>
  <div id="loadingDiv"></div>
</body>
</html>